{"ast":null,"code":"import _defineProperty from\"D:/Business/Programming/react_lists/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"D:/Business/Programming/react_lists/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"D:/Business/Programming/react_lists/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"D:/Business/Programming/react_lists/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useContext}from'react';import{AppContext}from'../../context/AppContext';import styles from'./ItemCard.module.css';import ItemCardItem from'./ItemCardItem';import{useClickOutside}from'../Helpers/ClickOutside';import{DragDropContext,Droppable,Draggable}from'react-beautiful-dnd';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ItemCard(_ref){var item=_ref.item,items=_ref.items;var _useState=useState(item),_useState2=_slicedToArray(_useState,2),itemInput=_useState2[0],setitemInput=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),itemMenu=_useState4[0],setItemMenu=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),moveMenu=_useState6[0],setMoveMenu=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),editTitle=_useState8[0],setEditTitle=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),addChild=_useState10[0],setAddChild=_useState10[1];var _useState11=useState({title:'',description:'',tags:[],parent:item.id}),_useState12=_slicedToArray(_useState11,2),childInput=_useState12[0],setChildInput=_useState12[1];var _useContext=useContext(AppContext),_children=_useContext.children,dispatch=_useContext.dispatch;var childItems=_toConsumableArray(items).filter(function(i){return item.id===i.parent;});childItems.sort(function(a,b){return a.index>b.index?1:-1;});var nextId=function nextId(){return items.reduce(function(id,item){return item.id>id?item.id:id;},0)+1;};var handleTitleSave=function handleTitleSave(e){if(e.charCode===13){if(!itemInput.title||/^\\s*$/.test(itemInput.title))return;dispatch({type:'UPDATE_ITEM',payload:itemInput});setEditTitle(false);}};var handleChange=function handleChange(e){var _ref2=[e.target.name,e.target.value],name=_ref2[0],value=_ref2[1];setitemInput(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},name,value));});};var handleChildChange=function handleChildChange(e){var _ref3=[e.target.name,e.target.value],name=_ref3[0],value=_ref3[1];setChildInput(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},name,value));});};var handleDelete=function handleDelete(){dispatch({type:'DELETE_ITEM',payload:item});setItemMenu(false);};var handleChildSave=function handleChildSave(e){if(e.charCode===13)handleAddChild();};var handleAddChild=function handleAddChild(){if(addChild&&childInput.title.length>0){if(!childInput.title||/^\\s*$/.test(childInput.title))return;var child=childInput;child.id=nextId();child.index=childItems.length;dispatch({type:'ADD_ITEM',payload:child});setChildInput({title:'',description:'',tags:[],parent:item.id});setAddChild(false);}else{setAddChild(true);}};var handleCopy=function handleCopy(){var copy=JSON.parse(JSON.stringify(item));copy.id=nextId();copy.index=childItems.length;copy.title=item.title+' - copy';dispatch({type:'ADD_ITEM',payload:copy});setItemMenu(false);};var handleMoveMenu=function handleMoveMenu(){var availible=_toConsumableArray(items).filter(function(i){return item.id!==i.id&&item.parent!==i.id&&!_children(item).includes(i);});setMoveMenu(availible);};var handleMove=function handleMove(e){var key=Number(e.target.dataset.key);var copy=_objectSpread({},item);copy.parent=key>0?key:null;copy.index=items.filter(function(i){return copy.parent===i.parent;}).length;console.log('index',copy.index);dispatch({type:'UPDATE_ITEM',payload:copy});setMoveMenu(null);setItemMenu(false);};var handleDragEnd=function handleDragEnd(result){if(!result.destination)return;var _items=Array.from(childItems);var _items$splice=_items.splice(result.source.index,1),_items$splice2=_slicedToArray(_items$splice,1),reordered=_items$splice2[0];_items.splice(result.destination.index,0,reordered);_items.forEach(function(i,index){return i.index=index;});dispatch({type:'UPDATE_ITEMS',payload:_items});};var domTitle=useClickOutside(function(){setEditTitle(false);});var domMenu=useClickOutside(function(){setItemMenu(false);});return/*#__PURE__*/_jsxs(\"div\",{className:styles.warp,children:[itemMenu&&/*#__PURE__*/_jsx(\"div\",{ref:domMenu,className:\"z-depth-5 \".concat(styles.menuWrap),children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"i\",{onClick:function onClick(){return setItemMenu(false);},className:\"material-icons \".concat(styles.icon),children:\"close\"})}),/*#__PURE__*/_jsx(\"li\",{onClick:function onClick(){handleAddChild();setItemMenu(false);},children:\"Add\"}),/*#__PURE__*/_jsx(\"li\",{onClick:handleCopy,children:\"Copy\"}),/*#__PURE__*/_jsx(\"li\",{onClick:handleMoveMenu,children:\"Move\"}),moveMenu&&/*#__PURE__*/_jsx(\"li\",{className:styles.scrollList,children:/*#__PURE__*/_jsxs(\"ul\",{children:[item.parent&&/*#__PURE__*/_jsx(\"li\",{onClick:handleMove,\"data-key\":\"0\",children:\"Dashboard\"}),moveMenu.map(function(i){return/*#__PURE__*/_jsx(\"li\",{onClick:handleMove,\"data-key\":i.id,children:i.title},i.id);})]})}),/*#__PURE__*/_jsx(\"li\",{onClick:handleDelete,children:\"Delete\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-panel \".concat(styles.cardPanel),children:[/*#__PURE__*/_jsxs(\"ul\",{children:[editTitle?/*#__PURE__*/_jsx(\"input\",{ref:domTitle,type:\"text\",value:itemInput.title,name:\"title\",className:styles.inputSmall,onChange:handleChange,onKeyPress:handleTitleSave}):/*#__PURE__*/_jsx(\"h5\",{onClick:function onClick(){return setEditTitle(true);},className:styles.heading,children:item.title}),/*#__PURE__*/_jsx(\"i\",{onClick:function onClick(){return setItemMenu(!itemMenu);},className:\"material-icons right \".concat(styles.icon),children:\"more_horiz\"}),/*#__PURE__*/_jsx(DragDropContext,{onDragEnd:handleDragEnd,children:/*#__PURE__*/_jsx(Droppable,{droppableId:\"items\",children:function children(provided){return/*#__PURE__*/_jsxs(\"div\",_objectSpread(_objectSpread({className:\"items\"},provided.droppableProps),{},{ref:provided.innerRef,children:[childItems.map(function(i,index){return/*#__PURE__*/_jsx(Draggable,{draggableId:'item_'+i.id,index:index,children:function children(provided){return/*#__PURE__*/_jsx(\"div\",_objectSpread(_objectSpread(_objectSpread({ref:provided.innerRef},provided.draggableProps),provided.dragHandleProps),{},{className:\"card-panel \".concat(styles.childItem,\" \").concat(styles.warp),children:/*#__PURE__*/_jsx(ItemCardItem,{item:i,maxIndex:childItems.length})}));}},i.id);}),provided.placeholder]}));}})})]}),/*#__PURE__*/_jsxs(\"div\",{className:addChild?'active':'',children:[/*#__PURE__*/_jsx(\"div\",{className:\"collapsible-body card-panel \".concat(styles.collapsibleBody),style:addChild?{display:'block'}:{},children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Title\",value:childInput.title,name:\"title\",className:styles.inputSmall,onChange:handleChildChange,onKeyPress:handleChildSave})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleAddChild,className:\"btn secondary\",children:addChild?'Save item':'Add item'}),addChild&&/*#__PURE__*/_jsx(\"i\",{onClick:function onClick(){return setAddChild(false);},className:\"material-icons right \".concat(styles.iconClose),children:\"close\"})]})]})]});}","map":{"version":3,"sources":["D:/Business/Programming/react_lists/src/components/ItemCard/ItemCard.js"],"names":["React","useState","useContext","AppContext","styles","ItemCardItem","useClickOutside","DragDropContext","Droppable","Draggable","ItemCard","item","items","itemInput","setitemInput","itemMenu","setItemMenu","moveMenu","setMoveMenu","editTitle","setEditTitle","addChild","setAddChild","title","description","tags","parent","id","childInput","setChildInput","children","dispatch","childItems","filter","i","sort","a","b","index","nextId","reduce","handleTitleSave","e","charCode","test","type","payload","handleChange","target","name","value","prev","handleChildChange","handleDelete","handleChildSave","handleAddChild","length","child","handleCopy","copy","JSON","parse","stringify","handleMoveMenu","availible","includes","handleMove","key","Number","dataset","console","log","handleDragEnd","result","destination","_items","Array","from","splice","source","reordered","forEach","domTitle","domMenu","warp","menuWrap","icon","scrollList","map","cardPanel","inputSmall","heading","provided","droppableProps","innerRef","draggableProps","dragHandleProps","childItem","placeholder","collapsibleBody","display","iconClose"],"mappings":"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","sourcesContent":["import React, {useState, useContext} from 'react';\r\nimport { AppContext } from '../../context/AppContext';\r\nimport styles from './ItemCard.module.css';\r\nimport ItemCardItem from './ItemCardItem';\r\nimport { useClickOutside } from '../Helpers/ClickOutside';\r\nimport { DragDropContext, Droppable, Draggable  } from 'react-beautiful-dnd';\r\n\r\nexport default function ItemCard({item, items}) {\r\n    const [itemInput, setitemInput] = useState(item)\r\n    const [itemMenu, setItemMenu] = useState(false)\r\n    const [moveMenu, setMoveMenu] = useState(null)\r\n\r\n    const [editTitle, setEditTitle] = useState(false)\r\n\r\n    const [addChild, setAddChild] = useState(false)\r\n    const [childInput, setChildInput] = useState({title:'', description:'', tags:[], parent:item.id})\r\n\r\n    const { children, dispatch } = useContext(AppContext);\r\n\r\n    const childItems = [...items].filter(i => item.id === i.parent)\r\n    childItems.sort((a, b) => (a.index > b.index) ? 1 : -1)\r\n\r\n    const nextId = () => items.reduce((id, item)=>( item.id > id ? item.id : id), 0) + 1\r\n\r\n    const handleTitleSave = (e) => {\r\n        if (e.charCode === 13) {\r\n            if (! itemInput.title || /^\\s*$/.test(itemInput.title)) return\r\n\r\n            dispatch({\r\n                type:'UPDATE_ITEM',\r\n                payload: itemInput\r\n            });\r\n            setEditTitle(false)\r\n        }\r\n    }\r\n\r\n    const handleChange = (e) => {\r\n        const [name, value] = [e.target.name, e.target.value]\r\n        setitemInput(prev => {\r\n            return { ...prev, [name]:value }\r\n        })\r\n    }\r\n\r\n    const handleChildChange = (e) => {\r\n        const [name, value] = [e.target.name, e.target.value]\r\n        setChildInput(prev => {\r\n            return { ...prev, [name]:value }\r\n        })\r\n    }\r\n\r\n    const handleDelete = () => {\r\n        dispatch({\r\n            type:'DELETE_ITEM',\r\n            payload: item\r\n        });\r\n        setItemMenu(false)\r\n    }   \r\n\r\n    const handleChildSave = (e) => { if (e.charCode === 13) handleAddChild() }\r\n\r\n    const handleAddChild = () => {\r\n        if (addChild && childInput.title.length > 0) {\r\n            if (! childInput.title || /^\\s*$/.test(childInput.title)) return\r\n            const child = childInput;\r\n            child.id = nextId();\r\n            child.index = childItems.length;\r\n            dispatch({\r\n                type:'ADD_ITEM',\r\n                payload: child\r\n            });\r\n            setChildInput({title:'', description:'', tags:[], parent:item.id})\r\n            setAddChild(false)\r\n\r\n        } else {\r\n            setAddChild(true)    \r\n        }\r\n        \r\n    }\r\n\r\n    const handleCopy = () =>{\r\n        let copy =  JSON.parse(JSON.stringify(item));\r\n        copy.id = nextId()\r\n        copy.index = childItems.length;\r\n        copy.title = item.title + ' - copy'\r\n        dispatch({\r\n            type:'ADD_ITEM',\r\n            payload: copy\r\n        });\r\n        setItemMenu(false)\r\n    }\r\n\r\n    const handleMoveMenu = () => {\r\n        const availible = [...items].filter(i => item.id !== i.id && item.parent !== i.id && ! children(item).includes(i))\r\n        setMoveMenu(availible)\r\n    }\r\n    const handleMove = (e) => {\r\n        const key = Number(e.target.dataset.key)        \r\n        const copy = {...item}        \r\n        copy.parent = key > 0 ? key : null;\r\n        copy.index = items.filter(i => copy.parent === i.parent).length\r\n        console.log('index',copy.index)\r\n        dispatch({\r\n            type:'UPDATE_ITEM',\r\n            payload: copy\r\n        });\r\n        setMoveMenu(null)\r\n        setItemMenu(false)\r\n    }\r\n\r\n    const handleDragEnd = (result) => {\r\n        if (! result.destination) return \r\n        const _items = Array.from(childItems);\r\n        const [reordered] = _items.splice(result.source.index, 1);\r\n        _items.splice(result.destination.index, 0, reordered);\r\n        _items.forEach((i, index) => i.index = index);      \r\n        dispatch({\r\n            type:'UPDATE_ITEMS',\r\n            payload: _items\r\n        });\r\n    }\r\n\r\n    let domTitle = useClickOutside(() => {\r\n        setEditTitle(false)\r\n    })\r\n    let domMenu = useClickOutside(() => {\r\n        setItemMenu(false)\r\n    })\r\n    return (\r\n    <div className={styles.warp}>\r\n        {itemMenu &&\r\n        <div ref={domMenu} className={`z-depth-5 ${styles.menuWrap}`}>\r\n            <ul>\r\n                <li><i onClick={() => setItemMenu(false)} className={`material-icons ${styles.icon}`}>close</i></li>\r\n                <li onClick={() => {handleAddChild(); setItemMenu(false) }}>Add</li>\r\n                <li onClick={handleCopy}>Copy</li>\r\n                <li onClick={handleMoveMenu}>Move</li>\r\n                { moveMenu &&\r\n                <li className={styles.scrollList}>\r\n                    <ul>\r\n                        { item.parent && <li onClick={handleMove} data-key='0'>Dashboard</li>}\r\n                        {moveMenu.map((i)=>(\r\n                        <li onClick={handleMove} key={i.id} data-key={i.id}>{i.title}</li>\r\n                        ))}\r\n                    </ul>\r\n                </li>}\r\n                <li onClick={handleDelete}>Delete</li>\r\n            </ul>\r\n        </div>}\r\n        <div className={`card-panel ${styles.cardPanel}`}>\r\n            <ul>\r\n            {editTitle ? (\r\n            <input ref={domTitle} type=\"text\" value={itemInput.title} name='title' className={styles.inputSmall} onChange={handleChange} onKeyPress={handleTitleSave}/>\r\n            ) : (\r\n            <h5 onClick={() => setEditTitle(true)} className={styles.heading}>{item.title}</h5>)}\r\n            <i onClick={() => setItemMenu(!itemMenu)} className={`material-icons right ${styles.icon}`}>more_horiz</i>\r\n            <DragDropContext onDragEnd={handleDragEnd}>\r\n                <Droppable droppableId=\"items\">\r\n                {(provided) => (\r\n                <div \r\n                    className=\"items\"\r\n                    {...provided.droppableProps} \r\n                    ref={provided.innerRef} \r\n                >\r\n                    {childItems.map((i, index) => (\r\n                    <Draggable key={i.id} draggableId={'item_'+i.id} index={index}>\r\n                        {(provided) => (\r\n                            <div ref={provided.innerRef} {...provided.draggableProps} {...provided.dragHandleProps} className={`card-panel ${styles.childItem } ${styles.warp}`} >\r\n                                <ItemCardItem item={i} maxIndex={childItems.length} />\r\n                            </div>                                \r\n                        )}\r\n                    </Draggable>\r\n                    ))} \r\n                    {provided.placeholder} \r\n                </div>\r\n                )} \r\n                </Droppable>              \r\n            </DragDropContext>\r\n            </ul>\r\n            <div className={addChild ? 'active' : ''}>\r\n                <div className={`collapsible-body card-panel ${styles.collapsibleBody}`} style={addChild ? {display:'block'}:{}}>\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Title\"\r\n                        value={childInput.title}\r\n                        name='title'\r\n                        className={styles.inputSmall}\r\n                        onChange={handleChildChange}\r\n                        onKeyPress={handleChildSave}\r\n                    />\r\n                </div>\r\n                <button onClick={handleAddChild} className=\"btn secondary\">{addChild ? 'Save item' : 'Add item'}</button>\r\n                {addChild && <i onClick={() => setAddChild(false)} className={`material-icons right ${styles.iconClose}`}>close</i>}\r\n            </div>\r\n        </div>\r\n    </div>\r\n    )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}